# Анализатор сетевых протоколов с использованием LLM

## Описание проекта

Данный инструмент предназначен для автоматического анализа:
1. Исходного кода C/C++ на предмет функций-парсеров и  функций-обработчиков сетевых пакетов
2. RFC-документов для извлечения технических спецификаций

Основная цель - автоматизация начального этапа аудита сетевого ПО.

## Техническая реализация

### Ключевые технологии:
- **Языковая модель**: cognitivecomputations/dolphin3.0-r1-mistral-24b:free (через OpenRouter API)
- **Библиотеки**:
  - `requests` - HTTP-запросы к API
  - `python-dotenv` - управление переменными окружения
  - `concurrent.futures` - параллельный анализ файлов
  - `git` - клонирование репозиториев

### Конфигурация:
Файл `.env` должен содержать:
```ini
OPENROUTER_API_KEY=your_api_key_here
GITHUB_TOKEN=your_github_token_optional
```

### Особенности реализации:

- Анализ первых 5 файлов (self.max_files = 5):

- Поддержка C/C++ (.c, .h, .cpp, .hpp)

- Параллельная обработка (3 потока)

- Детальное логирование в analysis.log

- Из файлов берутся первые 15к символов, чтобы не перегружать API

## Трудности и решения

1. **Проблемы с API**:

    - Блокировки OpenRouter при частых запросах

    - Решение: ограничение скорости запросов, обработка ошибок 429

    - Ошибки связанные с проблемами серверов

    - Решение: обработка ошибок 509, ожидание спада нагрузки с сервера

2. **Выбор модели**:

    - Изначально рассматривал локальное развертывание через llama.cpp

    - Проблема: нехватка RAM (8Гб недостаточно)

    - Альтернатива: LangChain + OpenAI - дорого и сложно

    - Выбор: OpenRouter как баланс цены и удобства

3. **Формат ответов**:

    - Нестабильность JSON-вывода от разных моделей

    - Решение: строгие промпты и валидация ответов

4. **Анализ RFC**:

    - Сложность структурирования технических данных

    - Решение: многоуровневые промпты с примерами

## Результаты тестирования

На примере репозитория libhv (https://github.com/ithewei/libhv):

- Успешно идентифицированы:

    - Функции парсинга HTTP-заголовков

    - Обработчики TCP-пакетов и HTTP-пакетов

    - Утилиты работы с сокетами

- Извлечены спецификации из RFC 2616 (HTTP/1.1)

Проблемы:

- Ограничение бесплатного тарифа OpenRouter

- Не все модели стабильно возвращают JSON

## Рекомендации и выводы

1. **Для разработки**:

    - Лучше использовать официальные SDK (OpenAI, Anthropic)

    - Для локального запуска - модели 7B-параметров + квантование

2. **Для анализа**:

    - Дополнить статическим анализом (clang, cppcheck)

    - Добавить кэширование результатов

3. **Выводы**:

    - LLM эффективны для первичного анализа

    - Требуется значительная обработка ответов

    - OpenRouter - хороший вариант для экспериментов

## Полезные ссылки

1. OpenRouter API: https://openrouter.ai/docs

2. Dolphin-Mistral: https://huggingface.co/cognitivecomputations/dolphin-2.6-mistral-7b

3. RFC 2616: https://datatracker.ietf.org/doc/html/rfc2616

4. Libhv: https://github.com/ithewei/libhv

5. Python threading: https://docs.python.org/3/library/threading.html

6. Python docs: https://docs.python.org/3/

7. Prompt engineering course for beginners https://youtube.com/playlist?list=PL6gx4Cwl9DGDv5eyBLEd9l3ZZzVoroxIZ&si=d8UU-KDVKof6RlSH

8. Community related with LLM https://www.reddit.com/r/LocalLLaMA/

9. LangChain Doc https://python.langchain.com/docs/get_started/introduction